<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>广告盈亏决策系统 - 支出账精修版</title>
    <style>
        :root {
            --primary: #007AFF; --danger: #FF3B30; --success: #34C759;
            --bg: #F5F5F7; --card: #FFFFFF;
        }
        
        body { 
            font-family: -apple-system, "SF Pro SC", "PingFang SC", sans-serif; 
            margin: 0; padding: 10px; background: var(--bg); 
            overflow-x: hidden;
        }

        .container { 
            max-width: 1140px; margin: 0 auto; background: var(--card); 
            padding: 16px; border-radius: 18px; box-shadow: 0 8px 30px rgba(0,0,0,0.05);
            min-height: calc(100vh - 40px); display: flex; flex-direction: column;
            position: relative;
        }

        /* 右上角浅色水印 */
        .watermark {
            position: absolute; top: 20px; right: 25px;
            font-size: 13px; color: #1D1D1F; opacity: 0.12;
            font-weight: 500; pointer-events: none;
        }

        .preset-grid { display: flex; gap: 6px; margin-bottom: 18px; flex-wrap: wrap; padding-right: 150px; }
        .p-btn { 
            padding: 6px 12px; background: #FFF; border: 1px solid #D2D2D7; 
            border-radius: 9px; cursor: pointer; font-size: 11px; font-weight: 500;
            transition: 0.2s;
        }
        .p-btn.active { background: #1D1D1F; color: white; border-color: #1D1D1F; }

        .config-bar { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; 
            padding: 15px; background: #F8F8F9; border-radius: 14px; margin-bottom: 18px;
        }
        .input-item label { font-size: 11px; font-weight: 600; color: #86868B; margin-bottom: 6px; display: block;}
        .input-item input { 
            width: 85%; padding: 10px; border: 1px solid #D2D2D7; border-radius: 10px; 
            font-size: 14px; outline: none;
        }
        .input-item input:focus { border-color: var(--primary); }

        .table-wrap { flex: 1; border-radius: 14px; border: 1px solid #E5E5EA; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; text-align: center; table-layout: fixed; }
        
        thead th { background: #1D1D1F; color: white; font-size: 11px; padding: 12px 2px; border-right: 0.5px solid #3A3A3C; }
        .sub-head { background: #F2F2F7 !important; color: #636366 !important; font-size: 10px !important; border-bottom: 1px solid #D2D2D7 !important; }

        tbody td { border: 0.5px solid #E5E5EA; font-size: 12px; padding: 12px 4px; }
        .row-label { background: #F2F2F7 !important; font-weight: bold; width: 60px; }

        .is-base-row { background: #FFFBE6 !important; }
        .is-base-row td { font-weight: 800; font-size: 14px !important; color: #000; }

        .is-focus { 
            background: #FFF !important; color: var(--primary) !important; 
            font-size: 16px !important; font-weight: 900 !important;
            box-shadow: inset 0 0 0 2px var(--primary); 
        }

        .loss { color: var(--danger); }
        .profit { color: var(--success); }
        .empty-val { color: transparent !important; } 
    </style>
</head>
<body>

<div class="container">
    <div class="watermark">石一凡经营分析</div>

    <div class="preset-grid" id="presetBox"></div>

    <div class="config-bar">
        <div class="input-item"><label>厂家基础返点 (%)</label><input type="number" id="f_base" value="37" oninput="calc()"></div>
        <div class="input-item"><label>给客户返点 (%)</label><input type="number" id="c_base" value="49" oninput="calc()"></div>
        <div class="input-item"><label>季度现金返现 (%)</label><input type="number" id="q_base" value="0" step="0.1" oninput="calc()"></div>
        <div class="input-item"><label>年度现金返现 (%)</label><input type="number" id="y_base" value="0" step="0.1" oninput="calc()"></div>
    </div>

    <div class="table-wrap">
        <table id="mainTable">
            <thead id="theader"></thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
</div>

<script>
const industryData = [
    { n: "短剧搜索", f: 22 }, { n: "短剧信息流", f: 37 }, 
    { n: "四品搜索", f: 19 }, { n: "四品信息流", f: 30 }, 
    { n: "直营电商", f: 37 }, 
    { n: "引流搜索", f: 22 }, { n: "引流信息流", f: 30 }, 
    { n: "旅行社搜索", f: 19 }, { n: "旅行社信息流", f: 30 }
];

function init() {
    const box = document.getElementById('presetBox');
    industryData.forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'p-btn';
        btn.innerText = item.n;
        btn.onclick = () => {
            document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('f_base').value = item.f;
            calc();
        };
        box.appendChild(btn);
    });
    calc();
}

function calc() {
    const getRaw = (id) => parseFloat(document.getElementById(id).value) || 0;
    const q_raw = getRaw('q_base');
    const y_raw = getRaw('y_base');
    
    const f = getRaw('f_base') / 100, c = getRaw('c_base') / 100, q = q_raw / 100, y = y_raw / 100;

    const q_list = [q - 0.005, q, q + 0.005];
    const y_list = [y - 0.005, y, y + 0.005];

    let headHtml = `<tr><th rowspan="2" style="width:60px">客户报价</th>`;
    q_list.forEach((qv) => { 
        headHtml += `<th colspan="3">季度返点: ${(qv*100).toFixed(1)}%</th>`; 
    });
    headHtml += `</tr><tr class="sub-head">`;
    for(let i=0; i<3; i++) {
        y_list.forEach((yv) => { 
            headHtml += `<th class="sub-head">${(yv*100).toFixed(1)}% (年)</th>`; 
        });
    }
    document.getElementById('theader').innerHTML = headHtml + `</tr>`;

    let bodyHtml = '';
    for (let i = -4; i <= 4; i++) { 
        let curC = c + (i / 100);
        let isBaseRow = (i === 0);
        bodyHtml += `<tr class="${isBaseRow ? 'is-base-row' : ''}">
            <td class="row-label">${(curC*100).toFixed(0)}%</td>`;
        
        q_list.forEach((qv, qIdx) => {
            y_list.forEach((yv, yIdx) => {
                // --- 支出账核心算法 ---
                // 1. 每实付厂家现金 100 元，获得账户流水 = 100 * (1 + f)
                // 2. 同样的流水，从客户处收回现金 = (100 * (1 + f)) / (1 + curC)
                // 3. 厂家端实际支出的净现金 = 100 * (1 - qv - yv)
                // 4. 净利润 = 客户收回 - 实际净支
                
                let incomeFromClient = (100 * (1 + f)) / (1 + curC);
                let netCostToVendor = 100 * (1 - qv - yv);
                let res = (incomeFromClient - netCostToVendor).toFixed(2);
                
                let isTargetCol = (qIdx===1 && yIdx===1);
                let hideThis = (q_raw === 0 && qIdx !== 1) || (y_raw === 0 && yIdx !== 1);

                let hideClass = hideThis ? 'empty-val' : '';
                let focusClass = (isBaseRow && isTargetCol) ? 'is-focus' : '';
                let colorClass = res < 0 ? 'loss' : 'profit';
                
                bodyHtml += `<td class="${hideClass} ${focusClass} ${colorClass}">${res}</td>`;
            });
        });
        bodyHtml += `</tr>`;
    }
    document.getElementById('tbody').innerHTML = bodyHtml;
}
init();
</script>
</body>
</html>
